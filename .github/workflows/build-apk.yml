name: Build Real APK

on:
  workflow_dispatch:
    inputs:
      html_file:
        description: 'HTML file path (from repository root)'
        required: true
        default: 'templates/app.html'
      app_name:
        description: 'App name'
        required: true
        default: 'MyWebApp'
      package_name:
        description: 'Package name (ex: com.company.app)'
        required: true
        default: 'com.example.myapp'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Android SDK
      uses: android-actions/setup-android@v3
      
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          openjdk-11-jdk \
          wget \
          unzip \
          zip \
          imagemagick
          
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install Python dependencies
      run: |
        pip install pillow
        
    - name: Create Real APK
      run: |
        # Criar template se n√£o existir
        mkdir -p templates
        if [ ! -f templates/app.html ]; then
          echo "<html><body><h1>Meu App</h1><p>APK gerado com sucesso!</p></body></html>" > templates/app.html
        fi
        
        # Executar criador REAL de APK
        python src/real_apk_creator.py \
          --html "templates/app.html" \
          --app-name "MeuAppTeste" \
          --package-name "com.test.myapp"
          
    - name: List generated files
      run: |
        echo "üìÅ Conte√∫do do diret√≥rio:"
        ls -la
        echo "üìÅ Conte√∫do de dist/:"
        ls -la dist/ || echo "dist/ n√£o existe"
        echo "üìÅ Conte√∫do de dist/apks/:"
        ls -la dist/apks/ || echo "dist/apks/ n√£o existe"
        
    - name: Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: real-generated-apk
        path: dist/apks/*.apk
        if-no-files-found: error
        retention-days: 30

    - name: Create GitHub Release
      if: success()
      uses: softprops/action-gh-release@v1
      with:
        files: dist/apks/*.apk
        tag_name: real-apk-${{ github.run_id }}
        release_name: "Real APK - ${{ github.event.inputs.app_name }}"
        body: |
          APK REAL gerado com ferramentas Android
          - App: ${{ github.event.inputs.app_name }}
          - Package: ${{ github.event.inputs.package_name }}
          - Build: ${{ github.run_id }}
